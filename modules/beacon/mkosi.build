#!/bin/bash
set -euo pipefail
set -x

# Use BEACON_TAG if set, otherwise fetch from GitHub API
LATEST_TAG="${BEACON_TAG:-$(curl -s https://api.github.com/repos/AMDEPYC/beacon/releases/latest | jq -r '.tag_name')}"

# Download and install into DESTDIR with correct permissions
curl -fsSL "https://github.com/AMDEPYC/beacon/releases/download/${LATEST_TAG}/beacon-linux-x86_64" \
  | install -D -m 0755 /dev/stdin "${DESTDIR}/usr/local/bin/beacon"
